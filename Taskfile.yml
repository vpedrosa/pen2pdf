version: "3"

vars:
  BIN: ./bin/pen2pdf

tasks:
  default:
    desc: Run lint, test, and build
    cmds:
      - task: lint
      - task: test
      - task: build

  lint:
    desc: Run golangci-lint
    cmds:
      - golangci-lint run ./...

  test:
    desc: Run tests with race detector and coverage
    cmds:
      - go test ./... -race -coverprofile=coverage.out

  build:
    desc: Build the binary
    cmds:
      - go build -o {{.BIN}} .
    sources:
      - "**/*.go"
      - go.mod
      - go.sum
    generates:
      - "{{.BIN}}"

  dev:
    desc: Start Air for hot-reload development
    cmds:
      - air

  clean:
    desc: Remove build artifacts
    cmds:
      - rm -rf bin/ tmp/ coverage.out

  fmt:
    desc: Format code
    cmds:
      - go fmt ./...
